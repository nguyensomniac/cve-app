# Usage: python3 refactor_berkeleyside.py INPUT.json OUTPUT.json
# Takes the raw spreadsheet data from INPUT.json, removes the
# full text of each item, and reformats columns to be more suitable to use
# programmatically. Then takes the result and writes to OUTPUT.json.

import sys, json, ast

with open(sys.argv[1] , "r") as infile, open(sys.argv[2], "w") as outfile:
  print("Opening %s" % sys.argv[1])

  # the list of articles
  article_list = []
  for line in infile:
    article_list.extend(json.loads(line))

  for article in article_list:
    article.pop("Full Text")
    article.pop("Coder Initials")
    article["Lat"] = article.pop("Latitude (decimal form)")
    article["Lon"] = article.pop("Longitude (decimal form)")
    article["Place"] = article.pop("Natural Language Location")
    article["ZIP"] = article.pop("Zip Code")
    article["Tags"] = ast.literal_eval(article["Tags"])

  print("Writing to %s" % sys.argv[2])
  json.dump(article_list, outfile)
