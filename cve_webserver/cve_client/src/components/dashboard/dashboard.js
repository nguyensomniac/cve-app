import React, { Component } from 'react';
// import PropTypes from 'prop-types';
import styles from './dashboard.css';
import data from './goals.json';
import Modal from 'react-modal';

// npm install --save react-modal
// https://github.com/reactjs/react-modal

class DashBoard extends Component {
 
	constructor() {

	    super();

	    this.state = {
	      modalIsOpen: false
	    };

		this.openModal = this.openModal.bind(this);
		this.afterOpenModal = this.afterOpenModal.bind(this);
		this.closeModal = this.closeModal.bind(this);
	}

	openModal() {
		this.setState({modalIsOpen: true});
	}	

	afterOpenModal() {
		// references are now sync'd and can be accessed.
		this.subtitle.style.color = '#f00';
	}

	closeModal() {
		this.setState({modalIsOpen: false});
	}


	render() {
	
		function get_current_percent(goal) {
			return 1;
		}

		function get_current_amount(goal) {
			return 2;
		}

		function format_metric(goal) {
			if (goal["benchmark_metric"] === "percent") {
				return <span> {get_current_percent(goal)} % </span>
			} else {
				return <span> {get_current_amount(goal)} </span>
			}
		}

		function compare_metric(goal) {
			if (get_current_percent(goal) < goal["benchmark_goal"]) {
				return -1;
			} else {
				return 1;
			}
		}

    	function submit(e) {
    		e.preventDefault();
    		var goal =  {
					   "community": "North Berkeley",
					   "benchmark_metric": "percent",
					   "benchmark_goal": "12"
					 };
    		save_new_goal(goal);
    		window.location.reload();
    	}

    	function save_new_goal(goal) {

    	}

    	function make_tile(goal) {
    		var indicator;
    		if (compare_metric(goal) < 0) {
    			indicator = styles.low;
    		}  else {
    			indicator = styles.high;
    		}

    		return (
	    		<div className={styles.tile}> 
					<div className={styles.title}> In {goal["community"]}</div>
					<div className={indicator}> you have: {format_metric(goal)}</div>
				</div>
			)
	    }


        var tiles = data.map(function(goal) {
            return (
            	<div> {make_tile(goal)} </div>
			);
        });

    	return (
			<div className={styles.container}> 
				 {tiles}
				 <div className={styles.tile}>
				 	<div className={styles.make_new} onClick={this.openModal}>
				 		+ Make a New Watch Tile

				 	</div>
				 </div>
				 <Modal
			          isOpen={this.state.modalIsOpen}
			          onAfterOpen={this.afterOpenModal}
			          onRequestClose={this.closeModal}
			          className={styles.modal}
			          contentLabel="new_tile"
			        >

			          <h2 ref={subtitle => this.subtitle = subtitle}>Make a new watch tile</h2>
			          <form onSubmit={this.submit}>

			          	<div>What community would you like to watch? </div>
							<select>
							  <option value="north">North Berkeley</option>
							  <option value="south">South Berkeley</option>
							  <option value="downtown">Downtown Berkeley</option>
							  <option value="east">East Berkeley</option>
							</select>
			          	<div> Would you like to set a benchmark? </div>
				         	 <input type="radio" name="benchmark" value="percent" /> Percent of Articles <br/>
							 <input type="radio" name="benchmark" value="quantity" /> Number of Articles <br/>
							 <input type="radio" name="benchmark" value="none" /> None <br/>
							 <input type="text" name="amount" /> Amount <br />

							 <button>Submit</button>
			          </form>
			       </Modal>
			</div>
		)
	}
}

export default DashBoard;
